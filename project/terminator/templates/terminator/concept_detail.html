{% extends "base.html" %}
{% load guardian_tags %}
{% load comments %}
{% load i18n %}

{% comment %}
Copyright 2011 Leandro Regueiro

This file is part of Terminator.

Terminator is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Terminator is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with Terminator.  If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}


{% block breadcrumbs %}
    » <a href="/glossaries/{{ concept.glossary.pk }}/">{{ concept.glossary }}</a> » <a href="/concepts/{{ concept.pk }}/">{% blocktrans with concept_id=concept.pk %}Concept #{{ concept_id }}{% endblocktrans %}</a>{% if current_language %} » <a href="/concepts/{{ concept.pk }}/{{ current_language.pk }}/">{{ current_language }}</a>{% endif %}
{% endblock %}


{% block content %}
    
    {% get_obj_perms user for concept.glossary as "glossary_perms" %}
    
    
    <h1><img src="{{ STATIC_PREFIX }}images/concept_32.png" />{% blocktrans with concept_id=concept.pk %}Concept #{{ concept_id }}{% endblocktrans %}</h1>
    
    {% if concept.get_list_of_used_languages %}
        <div class="language_link_list align_left_list">
        {% for lang in concept.get_list_of_used_languages %}
            {% if lang != current_language.pk %}
                <a href="/concepts/{{ concept.pk }}/{{ lang }}/" class="language_link">{{ lang }}</a>
            {% else %}
                <span class="current_language">{{ lang }}</span>
            {% endif %}
        {% endfor %}
        </div>
    {% endif %}
    
    
    
    {% if "is_lexicographer_in_this_glossary" in glossary_perms %}
        <p><a href="/admin/terminator/concept/{{ concept.pk }}/"><img src="{{ STATIC_PREFIX }}images/icon_edit_16.png" />{% trans "edit this concept" %}</a> &nbsp; &nbsp;
        <a href="/admin/terminator/concept/{{ concept.pk }}/delete/"><img src="{{ STATIC_PREFIX }}images/icon_delete_16.png" />{% trans "delete this concept" %}</a></p>
    {% endif %}
    
    <p><b>{% trans "Subject field:" %}</b>{% if concept.subject_field %} <a href="/concepts/{{ concept.subject_field.pk }}/">{{ concept.subject_field }}</a>{% endif %}</p>
    
    <p><b>{% trans "Broader concept:" %}</b>{% if concept.broader_concept %} <a href="/concepts/{{ concept.broader_concept.pk }}/">{{ concept.broader_concept }}</a>{% endif %}</p>
    
    <p><b>{% trans "Related concepts:" %}</b></p>
    <ul>
    {% for related_concept in concept.related_concepts.all %}
        <li><a href="/concepts/{{ related_concept.pk }}/">{{ related_concept }}</a></li>
    {% endfor %}
    </ul>
    
    
    
    <h2>{% trans "Definitions" %}</h2>
    {% if "is_terminologist_in_this_glossary" in glossary_perms %}
        <p><a href="/admin/terminator/definition/add/?concept={{ concept.pk }}"><img src="{{ STATIC_PREFIX }}images/icon_add_16.png" /> {% trans "add a new definition to this concept" %}</a></p>
    {% endif %}
    
    <div class="language_link_list">
    {% for definition in concept.definition_set.all %}
        {% if definition.language != current_language %}
            <a href="/concepts/{{ concept.pk }}/{{ definition.language.pk }}/" class="language_link">{{ definition.language.pk }}</a>
        {% else %}
            <span class="current_language">{{ definition.language.pk }}</span>
        {% endif %}
    {% endfor %}
    </div>
    
    <ul class="itemlist">
    {% for definition in concept.definition_set.all %}
        {% if not current_language or current_language and definition.language == current_language %}
            <li class="definitionitem"><p><b>{{ definition.language }}</b> &nbsp; {% if not definition.is_finalized %}<span class="not_finalized">{% trans "(Not finalized)" %}</span>{% endif %}
            {% if "is_terminologist_in_this_glossary" in glossary_perms %}
                &nbsp; &nbsp;
                <a href="/admin/terminator/definition/{{ definition.pk }}/"><img src="{{ STATIC_PREFIX }}images/icon_edit_16.png" />{% trans "edit this definition" %}</a> &nbsp; &nbsp;
                <a href="/admin/terminator/definition/{{ definition.pk }}/delete/"><img src="{{ STATIC_PREFIX }}images/icon_delete_16.png" /> {% trans "delete this definition" %}</a>
            {% endif %}
            </p>
            
            <p{% if not definition.is_finalized %} class="not_finalized_item"{% endif %}>
            {{ definition.definition_text|linebreaksbr }}
            </p>
            {% if definition.source %}<p class="gray_text"><b>{% trans "Source:" %}</b> <a href="{{ definition.source }}">{{ definition.source }}</a></p>{% endif %}<!-- TODO use the truncate_chars filter that will be available on Django 1.4 -->
            </li>
        {% endif %}
    {% endfor %}
    </ul>
    
    
    
    <h2>{% trans "External resources" %}</h2>
    {% if "is_terminologist_in_this_glossary" in glossary_perms %}
        <p><a href="/admin/terminator/externalresource/add/?concept={{ concept.pk }}"><img src="{{ STATIC_PREFIX }}images/icon_add_16.png" /> {% trans "add a new external resource to this concept" %}</a></p>
    {% endif %}
    
    <ul class="itemlist">
    {% for externalresource in concept.externalresource_set.all %}
        <li{% if not forloop.last %} class="external_resource"{% endif %}>{{ externalresource.language }}: <a href="{{ externalresource.address }}"> {{ externalresource.address }}</a><!-- TODO se é unha imaxe ou un vídeo encastralo en vez poñer a ligazón --><!-- TODO use the truncate_chars filter that will be available on Django 1.4 -->
        {{ externalresource.description|linebreaks }}
        
        {% if "is_terminologist_in_this_glossary" in glossary_perms %}
            <p><a href="/admin/terminator/externalresource/{{ externalresource.pk }}/"><img src="{{ STATIC_PREFIX }}images/icon_edit_16.png" /> {% trans "edit this external resource" %}</a> &nbsp; &nbsp;
            <a href="/admin/terminator/externalresource/{{ externalresource.pk }}/delete/"><img src="{{ STATIC_PREFIX }}images/icon_delete_16.png" /> {% trans "delete this external resource" %}</a></p>
        {% endif %}
        </li>
    {% endfor %}
    </ul>
    
    
    
    <h2>{% trans "Translations" %}</h2>
    {% if "is_terminologist_in_this_glossary" in glossary_perms %}
        <p><a href="/admin/terminator/translation/add/?concept={{ concept.pk }}"><img src="{{ STATIC_PREFIX }}images/icon_add_16.png" /> {% trans "add a new translation to this concept" %}</a></p>
    {% endif %}
    
    <ul class="itemlist">
    {% for translation in concept.translation_set.all %}
        <li class="translation_entry">
        {% if not translation.process_status %}<span class="not_finalized_item">{% endif %}
        <p>{{ translation.language }}: <b>{{ translation.translation_text }}</b>
        
        {% if "is_terminologist_in_this_glossary" in glossary_perms %}
            &nbsp; &nbsp; <a href="/admin/terminator/translation/{{ translation.pk }}/"><img src="{{ STATIC_PREFIX }}images/icon_edit_16.png" /> {% trans "edit this translation" %}</a>
            &nbsp; &nbsp;
            <a href="/admin/terminator/translation/{{ translation.pk }}/delete/"><img src="{{ STATIC_PREFIX }}images/icon_delete_16.png" /> {% trans "delete this translation" %}</a>
        {% endif %}
        </p>
        
        <p>
        <b>{% trans "Status:" %}</b>
        {% if not translation.process_status %}<span class="not_finalized">{% trans "(Not finalized)" %}</span>{% endif %}
        {% if translation.administrative_status %}{{ translation.administrative_status }}{% endif %}
        {% if translation.administrative_status_reason %}&nbsp; <b>{% trans "Reason:" %}</b> {{ translation.administrative_status_reason }}{% endif %}
        </p>
        
        {% if translation.part_of_speech %}<p><b>{% trans "Part of speech:" %}</b> {{ translation.part_of_speech }}{% endif %}
        {% if translation.grammatical_gender %}<b>{% trans "Grammatical genre:" %}</b> {{ translation.grammatical_gender }}{% endif %}
        {% if translation.grammatical_number %}<b>{% trans "Grammatical number:" %}</b> {{ translation.grammatical_number }}{% endif %}
        {% if translation.part_of_speech %}</p>{% endif %}
        
        {% if translation.note %}<p><b>{% trans "Note:" %}</b> {{ translation.note }}</p>{% endif %}
        
        
        {% if translation.contextsentence_set.all %}
            <div class="translation_subcomponent">
                <h3>{% trans "Example sentences:" %}</h3>
                {% if "is_terminologist_in_this_glossary" in glossary_perms %}
                    <p><a href="/admin/terminator/contextsentence/add/?translation={{ translation.pk }}"><img src="{{ STATIC_PREFIX }}images/icon_add_16.png" /> {% trans "add a new example sentence to this translation" %}</a></p>
                {% endif %}
                
                <ul>
                {% for context_sentence in translation.contextsentence_set.all %}
                    <li class="subcomponent_entry"><p>{{ context_sentence.text }}</p>
                    {% if "is_terminologist_in_this_glossary" in glossary_perms %}
                        <p>
                        <a href="/admin/terminator/contextsentence/{{ context_sentence.pk }}/"><img src="{{ STATIC_PREFIX }}images/icon_edit_16.png" /> {% trans "edit this example sentence" %}</a> &nbsp; &nbsp;
                        <a href="/admin/terminator/contextsentence/{{ context_sentence.pk }}/delete/"><img src="{{ STATIC_PREFIX }}images/icon_delete_16.png" /> {% trans "delete this example sentence" %}</a>
                        </p>
                    {% endif %}
                    </li>
                {% endfor %}
                </ul>
            </div>
        {% endif %}
        
        
        {% if translation.corpusexample_set.all %}
            <div class="translation_subcomponent">
                <h3>{% trans "Links to real use examples:" %}</h3>
                {% if "is_terminologist_in_this_glossary" in glossary_perms %}
                    <p><a href="/admin/terminator/corpusexample/add/?translation={{ translation.pk }}"><img src="{{ STATIC_PREFIX }}images/icon_add_16.png" /> {% trans "add a new link to real use example to this translation" %}</a></p>
                {% endif %}
                
                <ul>
                {% for corpus_example in translation.corpusexample_set.all %}
                    <li class="subcomponent_entry">
                    <p><a href="{{ corpus_example.address }}">{{ corpus_example.address|slice:"70" }}{% if corpus_example.address|length > 70 %}...{% endif %}</a></p><!-- TODO change this slice filter and if tag for a truncate_chars filter that will be available on Django 1.4 -->
                    {% if corpus_example.description %}<p>{{ corpus_example.description }}</p>{% endif %}
                    {% if "is_terminologist_in_this_glossary" in glossary_perms %}
                        <p><a href="/admin/terminator/corpusexample/{{ corpus_example.pk }}/"><img src="{{ STATIC_PREFIX }}images/icon_edit_16.png" /> {% trans "edit this link to real use example" %}</a> &nbsp; &nbsp;
                        <a href="/admin/terminator/corpusexample/{{ corpus_example.pk }}/delete/"><img src="{{ STATIC_PREFIX }}images/icon_delete_16.png" /> {% trans "delete this link to real use example" %}</a></p>
                    {% endif %}
                    </li>
                {% endfor %}
                </ul>
            </div>
        {% endif %}
        {% if not translation.process_status %}</span>{% endif %}
        </li>
    {% endfor %}
    </ul>
    
    
    
    
    {% if current_language %}
        {% if summary_message %}
            <h2>{% blocktrans with language=summary_message.language %}Summary message for {{ language }}{% endblocktrans %}</h2>
            <div class="summary">
                <p><i>{% blocktrans with submit_date=summary_message.date %}Wrote on {{ submit_date }}:{% endblocktrans %}</i></p><!-- TODO arranxar o formato da data con algún filtro -->
                
                {% if "is_lexicographer_in_this_glossary" in glossary_perms %}
                    <p>
                    <a href="/admin/terminator/summarymessage/{{ summary_message.pk }}/"><img src="{{ STATIC_PREFIX }}images/icon_edit_16.png" /> {% trans "edit this summary message" %}</a> &nbsp; &nbsp;
                    <a href="/admin/terminator/summarymessage/{{ summary_message.pk }}/delete/"><img src="{{ STATIC_PREFIX }}images/icon_delete_16.png" /> {% trans "delete this summary message" %}</a>
                    </p>
                {% endif %}
                
                {% if not summary_message.is_finalized %}<p class="not_finalized">{% trans "(Not finalized)" %}</p>{% endif %}
                <p{% if not summary_message.is_finalized %} class="not_finalized_item"{% endif %}>{{ summary_message.text|linebreaksbr }}</p>
            </div>
        {% else %}
            {% if "is_lexicographer_in_this_glossary" in glossary_perms %}
                <h2>{% trans "Summary message" %}</h2>
                <p><a href="/admin/terminator/summarymessage/add/?concept={{ concept.pk }}&language={{ current_language.pk }}"><img src="{{ STATIC_PREFIX }}images/icon_add_16.png" /> {% blocktrans with language=current_language %}Add summary message for {{ language }}{% endblocktrans %}</a></p>
            {% endif %}
        {% endif %}
    {% endif %}
    
    
    
    
    
    <h2 id="comment_list">{% trans "Comments" %}</h2>
    
    <div class="language_link_list">
    {% for lang in available_languages %}
        {% if not comments_thread.language or lang != comments_thread.language %}
            <a href="/concepts/{{ concept.pk }}/{{ lang.pk }}/#comment_list" class="language_link">{{ lang.pk }}</a>
        {% else %}
            <span class="current_language">{{ lang.pk }}</span>
        {% endif %}
    {% endfor %}
    </div>
    
    
    <div class="comment_block">
    {% if comments_thread %}
        {% get_comment_count for comments_thread as comment_count %}
        <div class="comment_list_header">
            <div class="comment_list_count"><b>{% blocktrans count count=comment_count %}{{ count }} comment{% plural %}{{ count }} comments{% endblocktrans %}</b></div>
            <div class="comment_list_feed">
                <a href="/feeds/comments/{{ comments_thread.concept.pk }}/{{ comments_thread.language.pk }}"><img src="{{ STATIC_PREFIX }}images/rss_24.png" />{% trans "RSS feed with latest comments" %}</a>
            </div>
        </div>
        
        {% render_comment_list for comments_thread %}
        
        <div id="comment_form">
        {% if user.is_authenticated %}
            {% render_comment_form for comments_thread %}
        {% else %}
            <!-- TODO polo visto non rula o de redirixir ao formulario porque ao facer login borra o #comment_form do final da ligazón de next -->
            {% blocktrans %}You need to <a href="/accounts/login/?next={{ next }}#comment_form">log in</a> if you want to comment.{% endblocktrans %}
        {% endif %}
        </div>
    {% else %}
        <div class="no_comments">
            {% trans "You should click on one of the languages in the above list to see a comment thread." %}
        </div>
    {% endif %}
    </div>
{% endblock %}



{% block specificsidebar %}
    
    {% get_obj_perms user for concept.glossary as "glossary_perms" %}
    
    <ul class="sidebar_links">
        {% if "is_lexicographer_in_this_glossary" in glossary_perms %}
            <li><a href="/admin/terminator/concept/add/?glossary={{ concept.glossary.pk }}"><img src="{{ STATIC_PREFIX }}images/icon_add_16.png" /> {% trans "Add new concept" %}</a></li>
        {% endif %}
        <!-- TODO engadir máis ligazóns -->
        {% with other_concepts=concept.glossary.concept_set.all %}
            <li>
                <ul class="concept_list">
                {% for other_concept in other_concepts|slice:":10" %}
                    <li><a href="/concepts/{{ other_concept.pk }}/"><img src="{{ STATIC_PREFIX }}images/concept_16.png" />{{ other_concept }}</a></li>
                {% endfor %}
                </ul>
            </li>
            {% if other_concepts|length > 10 %}
                <li><a href="/glossaries/{{ concept.glossary.pk }}/">{% trans "See all glossary concepts" %}</a></li>
            {% endif %}
        {% endwith %}
    </ul>
    
    <hr />
{% endblock %}

